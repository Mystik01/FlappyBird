const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),aspectRatio=400/600;canvas.height=window.innerHeight,canvas.width=canvas.height*aspectRatio,ctx.fillStyle="lightblue",ctx.fillRect(0,0,canvas.width,canvas.height);let bird={x:50,y:150,velocityY:0,width:35,height:35},gravity=.6,jump=-8,pipes=[],pipeWidth=50,pipeGap=150,score=0,highScore=getCookie("highScore")||0,gameRunning=!0,frameCount=0;var debugMode=!1;let gameStarted=!1,gamePaused=!1,birdImg=new Image;function drawBird(){ctx.drawImage(birdImg,bird.x,bird.y,bird.width,bird.height)}function updateBird(){bird.velocityY+=gravity,bird.y+=bird.velocityY,(bird.y+bird.height>canvas.height||bird.y<0)&&gameOver()}function addPipe(){let e=canvas.height-pipeGap-100,t=Math.floor(Math.random()*(e-100+1))+100;pipes.push({x:canvas.width,y:t})}function drawPipes(){ctx.fillStyle="green",pipes.forEach((function(e){let t=e.y,i=t+pipeGap;ctx.fillRect(e.x,0,pipeWidth,t),ctx.fillRect(e.x,i,pipeWidth,canvas.height-i)}))}function updatePipes(){frameCount%120==0&&addPipe(),pipes.forEach((function(e,t){e.x-=2,e.x+pipeWidth<-pipeWidth&&pipes.splice(t,1),e.x+pipeWidth<bird.x&&!e.scored&&(score++,e.scored=!0),gameRunning&&collisionDetection(e)&&gameOver()}))}function collisionDetection(e){let t=bird.x+bird.width,i=bird.y+bird.height,a=e.x+pipeWidth,c=e.y,r=e.y+pipeGap;return t>e.x&&bird.x<a&&bird.y<c||t>e.x&&bird.x<a&&i>r}function timeUntilFloorCollision(){let e=canvas.height-(bird.y+bird.height),t=bird.velocityY,i=(-t+Math.sqrt(t*t+2*gravity*e))/gravity;return isNaN(i)||i<0?0:i}function perfectJump(){let e=pipes.find((e=>e.x+e.width>bird.x));e&&bird.y>=e.y+e.gap&&(bird.velocityY=-jump)}function drawDebug(){pipes.forEach((function(e){ctx.fillStyle="rgba(255, 0, 0, 0.3)",ctx.fillRect(e.x,0,pipeWidth,e.y),ctx.fillStyle="rgba(0, 0, 255, 0.3)",ctx.fillRect(e.x,e.y+pipeGap,pipeWidth,canvas.height-(e.y+pipeGap)),ctx.strokeStyle="red",ctx.lineWidth=2,ctx.strokeRect(e.x,0,pipeWidth,e.y),ctx.strokeRect(e.x,e.y+pipeGap,pipeWidth,canvas.height-(e.y+pipeGap))})),ctx.fillStyle="rgba(0, 255, 0, 0.3)",ctx.fillRect(bird.x,bird.y,bird.width,bird.height),ctx.strokeStyle="red",ctx.lineWidth=2,ctx.strokeRect(bird.x,bird.y,bird.width,bird.height),drawGravityArrow()}function drawGravityArrow(){let e=bird.velocityY,t=canvas.height-(bird.y+bird.height),i=(-e+Math.sqrt(e*e+2*gravity*t))/gravity;if((isNaN(i)||i<0)&&(i=0),Math.abs(e)>1){ctx.strokeStyle="purple",ctx.fillStyle="purple",ctx.lineWidth=2;let t=bird.x+bird.width/2,a=bird.y+bird.height/2,c=t,r=a+10*e;ctx.beginPath(),ctx.moveTo(t,a),ctx.lineTo(c,r),ctx.stroke();let n=5;ctx.beginPath(),ctx.moveTo(c,r),ctx.lineTo(c-n,r-n),ctx.lineTo(c+n,r-n),ctx.closePath(),ctx.fill(),ctx.fillStyle="black",ctx.font="14px Arial",ctx.fillText(`${i.toFixed(2)}ms`,c+10,r)}}function gameOver(){gameRunning=!1,gameStarted=!1,updateHighScore(),ctx.fillStyle="black",ctx.font="36px Arial",ctx.fillText("Game Over",100,canvas.height/2),ctx.fillText(`Score: ${score}`,130,canvas.height/2+40),ctx.fillText(`High Score: ${highScore}`,100,canvas.height/2+80),document.getElementById("restartButton").style.display="block"}function updateHighScore(){score>highScore&&(highScore=score,setCookie("highScore",highScore,365))}function restartGame(){bird={x:50,y:150,velocityY:0,width:30,height:30},pipes=[],score=0,gameRunning=!0,frameCount=0,document.getElementById("restartButton").style.display="none",gameStarted=!1,gameLoop()}function setCookie(e,t,i){const a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3);let c="expires="+a.toUTCString();document.cookie=e+"="+t+";"+c+";path=/"}function getCookie(e){let t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let a=i[e];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}function showPauseMenu(){ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="white",ctx.font="30px Arial",ctx.fillText("Game Paused",canvas.width/2-70,canvas.height/2)}function hidePauseMenu(){gameRunning||requestAnimationFrame(gameLoop)}function gameLoop(){gamePaused||ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="lightblue",ctx.fillRect(0,0,canvas.width,canvas.height),drawBird(),debugMode&&drawDebug(),gameStarted&&(drawPipes(),updateBird(),updatePipes(),ctx.font="20px Arial",ctx.fillStyle="black",ctx.fillText(score.toString(),10,30)),gamePaused?showPauseMenu():gameRunning&&requestAnimationFrame(gameLoop),frameCount++}birdImg.src="bird2.png",document.addEventListener("keydown",(function(e){"Space"===e.code&&(gameRunning?(bird.velocityY=jump,gameStarted=!0):restartGame()),e.ctrlKey&&e.altKey&&e.shiftKey&&"S"===e.key&&(debugMode=!debugMode),"Escape"===e.code&&gameStarted&&(gamePaused=!gamePaused,gamePaused?showPauseMenu():requestAnimationFrame(gameLoop)),e.ctrlKey&&e.altKey&&e.shiftKey&&"H"===e.key&&gameStarted&&perfectJump()})),canvas.addEventListener("click",(function(){gameRunning?(bird.velocityY=jump,gameStarted=!0):restartGame()})),canvas.addEventListener("touchstart",(function(e){gameRunning&&(bird.velocityY=jump,gameStarted=!0),e.preventDefault()}),!1),document.getElementById("restartButton").addEventListener("click",restartGame),gameLoop();